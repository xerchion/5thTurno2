<!DOCTYPE html>
<html>
<head>
    <title>5thTurno v1.0 </title>
    <link rel="stylesheet" href="estilos.css">
    <meta charset="utf-8">
    <style type="text/css">
        body {
            background: #fff;
            text-align: center;
            font-family: sans-serif;
        }

        .turno {
            font-size: 1em;
            padding-top: 1.5em;
        }
        .año {
            /* Aquí puedes cambiar el tamaño */
            font-size: 1em;
            color: #333;
        }
        .cabecera {
            text-align: center;
            font-size: 5em;
            color: black;

        }

        .grid-item {
            text-align: center;
            align-items: center;
            font-size: 1.5em;
            padding-top: 0px;
            display: flex;
            justify-content: center;
            border-radius: 8px;
            color: #777;
            font-size: 2.5em;
            font-weight: bold;
        }

        .grid-container {
            display: grid;
            grid-template-rows: repeat(8, 60px);
            grid-template-columns: repeat(7, 1fr);
            margin-left: 20%;
            margin-right: 20%;
            margin-top: 70px;
            gap: 10px;
            background-color: transparent;
            border-radius: 0;
            padding: 0;
            box-sizing: border-box;
        }

        .grid-item:first-child {
            background-color: #bbb;
            grid-column: 1 / 8;
            grid-row: 1 / 1;
            color: black;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            font-family: "Arial Black", sans-serif;
            font-style: italic;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
        }

        .grid-item:nth(2) {
            visibility: hidden;
        }

        #sem-item {
            background-color: #dfdfdf;
        }

        #mañana,
        #tarde,
        #noche,
        #festivo {
            color: white;
        }

        #mañana {
            background: linear-gradient(to bottom, #6ab7ff, #0077b6);
        }

        #tarde {
            background: linear-gradient(to bottom, #ffa500, #cc7a00);
        }

        #noche {
            background: linear-gradient(to bottom, #444444, #000000);
            color: #ffffff;
        }

        #festivo {
            background: linear-gradient(to bottom, #ff4d4d, #b30000);
        }

        h1 {
            background-color: blueviolet;
        }

        .seleccion-turno {
            font-size: 6em;
            color: white;
        }

        #hueco {
            visibility: hidden;
        }
        @keyframes parpadeo-pulso {
            0%, 100% {
              opacity: 1;
              border-width: 1px;
              transform: scale(1);
            }
            50% {
              opacity: 0.6;
              border-width: 9px;
              transform: scale(1.2);
            }
          }



          .dia-actual {
            border: 3px solid red;
            animation: parpadeo-pulso 2s ease-in-out infinite;
            border-radius: 5%;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
            margin: 0 auto;
            font-size: 2em;
            font-weight: bold;
            z-index: 10;
            width: 2em;
            transition: transform 0.2s;
          }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .grid-cabecera-semana {
            background-color: #ddd;
            color: #333;
            font-weight: bold;
            border-bottom: 2px solid #aaa;
            padding-bottom: 5px;
            border-radius: 8px 8px 0 0;
            display: flex;
            justify-content: space-around;
            align-items: center;
            width: 100%;

        }

        .grid-cabecera-semana div {
            width: 24.28%;
            text-align: center;
        }

        .mes-fondo-1,
        .mes-fondo-2,
        .mes-fondo-3,
        .mes-fondo-4,
        .mes-fondo-5,
        .mes-fondo-6,
        .mes-fondo-7,
        .mes-fondo-8,
        .mes-fondo-9,
        .mes-fondo-10,
        .mes-fondo-11,
        .mes-fondo-12 {
            background-color: #fff;
            border: 2px solid #ccc;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }

        #selector {
            margin: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            background-color: #f9f9f9;
            display: inline-block;
        }

        #selector label {
            margin-right: 10px;
        }

        #selector input,
        #selector select {
            padding: 5px;
            margin-right: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        #selector button {
            padding: 5px 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        #selector button:hover {
            background-color: #0056b3;
        }

        #modalOverlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }

        #selector {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            background: linear-gradient(135deg, #f9f9f9 60%, #e0e0ff 100%);
            box-shadow: 0 8px 32px rgba(0,0,0,0.25);
            display: none;
            min-width: 350px;
            min-height: 350px;
            padding: 40px 30px;
            font-size: 2em;
            border-radius: 24px;
            text-align: center;
            border: 2px solid #4B0082;
        }

        #selector h2 {
            font-size: 1.3em;
            margin-bottom: 30px;
            color: #4B0082;
        }

        #selector label {
            font-size: 1em;
            margin-bottom: 10px;
            color: #333;
            display: block;
        }

        #selector select,
        #selector input[type="number"] {
            font-size: 1em;
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 8px;
            border: 1px solid #aaa;
            width: 90%;
            max-width: 400px;
            box-sizing: border-box;
            background: #fff;
        }

        #selector button {
            padding: 12px 30px;
            background-color: #4B0082;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(75,0,130,0.15);
            transition: background 0.2s;
        }

        #selector button:hover {
            background-color: #6a1b9a;
        }

        @media (max-width: 600px) {
            #selector {
                min-width: 95vw;
                min-height: 60vh;
                font-size: 2em;
                padding: 20px 5px;
            }
            #selector select,
            #selector input[type="number"] {
                font-size: 1.2em;
                width: 98%;
                max-width: none;
            }
            #selector button {
                font-size: 1.2em;
                width: 98%;
            }
        }

        .oculto {
            display: none !important;
        }
    </style>
</head>
<body>
<!-- Icono menú -->
<div id="menuIcon" style="font-size:2.5em; cursor:pointer; margin:20px;">&#9776;</div>
<div id="modalOverlay"></div>
<div id="selector">
    <form id="calForm" autocomplete="off">
        <h2 style="margin-bottom: 30px; color: #4B0082;">Selecciona año y turno</h2>
        <label for="añoInput" style="font-weight:bold;">Año:</label>
        <select id="añoSelect" style="font-size:1em; margin-bottom:20px;"></select>
        <input type="number" id="añoInput" min="2022" style="font-size:1em; margin-bottom:20px;" />
        <label for="turnoInput" style="font-weight:bold;">Turno:</label>
        <select id="turnoInput" style="font-size:1em; margin-bottom:30px;">
            <option value="A">A</option>
            <option value="B">B</option>
            <option value="C" selected>C</option>
            <option value="D">D</option>
            <option value="E">E</option>
        </select>
        <button id="mostrarBtn" type="submit" style="margin-top:20px;">Mostrar calendario</button>
    </form>
</div>
    <script>
        const nombresDias = ["Lunes", "Martes", "Miercoles", "Jueves", "Viernes", "Sabado", "Domingo"];
        const nombresMeses = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
        let diasFijosMes = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
        let totalDiasAño = 365;

        class ValoresTurnos {
            generarValores() {
                let repValor = [2, 2, 3, 4, 3, 2, 2, 5, 2, 3, 2, 5];
                let valor = ["M", "T", "N", "D", "M", "T", "N", "D", "M", "T", "N", "D"];
                let patron = [];
                let dias = 0;
                while (dias < 400000) {
                    for (let iValor = 0; iValor < valor.length; iValor++) {
                        for (let jRepValor = 1; jRepValor <= repValor[iValor]; jRepValor++) {
                            patron[dias] = valor[iValor];
                            dias++;
                        }
                    }
                }
                return patron;
            }
        }

        class Dia {
            constructor(nombreDia, numeroDia, numeroDiaTotal, turnoToca) {
                this.nombreDia = nombreDia;
                this.numeroDia = numeroDia;
                this.numeroDiaTotal = numeroDiaTotal;
                this.turnoToca = turnoToca;
            }
        }

        class Mes {
            constructor(nombreMes, numeroMes, diasTotales, dias, festivos) {
                this.nombreMes = nombreMes;
                this.numMes = numeroMes;
                this.diasTotales = diasTotales;
                this.dias = dias;
                this.festivos = festivos;
            }
        }

        class Año {
            constructor(numeroAño) {
                this.numeroAño = numeroAño;
                this.meses = [];
            }
            rellenaAño() {
                // Comprobar si es bisiesto
                if ((this.numeroAño % 4 == 0 && this.numeroAño % 100 != 0) || this.numeroAño % 400 == 0) {
                    diasFijosMes[1] = 29;
                    totalDiasAño = 366;
                } else {
                    diasFijosMes[1] = 28;
                    totalDiasAño = 365;
                }
                let kDiaTotal = 1;
                for (let i = 0; i < 12; i++) {
                    let diasArray = [];
                    for (let j = 0; j < diasFijosMes[i]; j++) {
                        let fechaTemp = new Date(this.numeroAño, i, j + 1);
                        let diaSemana = nombresDias[(fechaTemp.getDay() + 6) % 7];
                        diasArray[j] = new Dia(diaSemana, j + 1, kDiaTotal++, "Sin meter");
                    }
                    this.meses[i] = new Mes(nombresMeses[i], i + 1, diasFijosMes[i], diasArray, 0);
                }
            }
        }

        class Calendario {
            constructor(año, turno, contenedor, añoUsuario) {
                this.año = año;
                this.turno = turno;
                this.contenedor = contenedor;
                this.añoUsuario = añoUsuario;
            }

            mesIndividualNuevo(mesTemp) {
                let mes = this.año.meses[mesTemp];
                let nuevoElemento = document.createElement("DIV");
                let gridContainer = this.contenedor.appendChild(nuevoElemento);
                gridContainer.classList.add("grid-container", `mes-fondo-${mesTemp + 1}`);
                nuevoElemento = document.createElement("DIV");
                let gridCabeceraMes = gridContainer.appendChild(nuevoElemento);
                gridCabeceraMes.classList.add("grid-item");
                gridCabeceraMes.textContent = mes.nombreMes;
                const diasSemana = ["L", "M", "X", "J", "V", "S", "D"];
                for (let j = 0; j < diasSemana.length; j++) {
                    nuevoElemento = document.createElement("DIV");
                    let gridCabeceraSem = gridContainer.appendChild(nuevoElemento);
                    gridCabeceraSem.classList.add("grid-item", "grid-cabecera-semana");
                    gridCabeceraSem.textContent = diasSemana[j];
                }
                let diaSemanaInicioMes = nombresDias.indexOf(mes.dias[0].nombreDia);
                for (let j = 1; j <= diaSemanaInicioMes; j++) {
                    nuevoElemento = document.createElement("DIV");
                    let gridEnBlanco = gridContainer.appendChild(nuevoElemento);
                    gridEnBlanco.classList.add("grid-item");
                    gridEnBlanco.textContent = "";
                    gridEnBlanco.id = ("hueco");
                }
                let fechaActual = new Date();
                let diaActual = fechaActual.getDate();
                let mesActual = fechaActual.getMonth();
                let añoActual = fechaActual.getFullYear();
                for (let i = 0; i < diasFijosMes[mesTemp]; i++) {
                    let turno = mes.dias[i].turnoToca;
                    let turnoLargo = "";
                    switch (turno) {
                        case "M": turnoLargo = "Mañana"; break;
                        case "T": turnoLargo = "Tarde"; break;
                        case "N": turnoLargo = "Noche"; break;
                        case "D": turnoLargo = "Descanso"; break;
                        case "F": turnoLargo = "Festivo"; break;
                    }
                    turnoLargo = turnoLargo.toLowerCase();
                    nuevoElemento = document.createElement("DIV");
                    let gridDiaItem = gridContainer.appendChild(nuevoElemento);
                    gridDiaItem.classList.add("grid-item");
                    gridDiaItem.textContent = i + 1;
                    gridDiaItem.id = turnoLargo;
                    if (añoActual === this.añoUsuario && mesActual === mesTemp && diaActual === i + 1) {
                        gridDiaItem.classList.add("dia-actual");
                    }
                }
            }

            rellenarCalendarioTurno(turno, diasInicioCalendario) {
                let valorTurnoInicio2022;
                switch (turno) {
                    case "A": valorTurnoInicio2022 = 19 + diasInicioCalendario; break;
                    case "B": valorTurnoInicio2022 = 33 + diasInicioCalendario; break;
                    case "C": valorTurnoInicio2022 = 12 + diasInicioCalendario; break;
                    case "D": valorTurnoInicio2022 = 26 + diasInicioCalendario; break;
                    case "E": valorTurnoInicio2022 = 5 + diasInicioCalendario; break;
                }
                let iTurnos = valorTurnoInicio2022;
                let patronGeneral = new ValoresTurnos();
                let patron = patronGeneral.generarValores();
                for (let iMeses = 0; iMeses < 12; iMeses++) {
                    for (let iDias = 0; iDias < diasFijosMes[iMeses]; iDias++) {
                        this.año.meses[iMeses].dias[iDias].turnoToca = patron[iTurnos++];
                    }
                }
                // Festivos fijos
                this.año.meses[0].dias[5].turnoToca = "F";
                this.año.meses[1].dias[27].turnoToca = "F";
                this.año.meses[4].dias[0].turnoToca = "F";
                this.año.meses[7].dias[14].turnoToca = "F";
                this.año.meses[9].dias[11].turnoToca = "F";
                this.año.meses[10].dias[0].turnoToca = "F";
                this.año.meses[11].dias[6].turnoToca = "F";
                this.año.meses[11].dias[8].turnoToca = "F";
            }

            mostrarAño() {
                for (let i = 0; i < 12; i++) {
                    this.mesIndividualNuevo(i);
                }
            }
        }

        // Función principal para inicializar y mostrar el calendario
        function inicializarCalendario(añoUsuario, turnoUsuario) {
            // Borrar anteriores si existen
            document.querySelectorAll('.cabecera, .contenedor').forEach(e => e.remove());

            // Crear cabecera y contenedor
            let nuevoElemento = document.createElement("DIV");
            let cabecera = document.body.appendChild(nuevoElemento);
            cabecera.classList.add("cabecera");
            nuevoElemento = document.createElement("DIV");
            let contenedor = document.body.appendChild(nuevoElemento);
            contenedor.classList.add("contenedor");
            nuevoElemento = document.createElement("DIV");
            let turnoElement = cabecera.appendChild(nuevoElemento);
            turnoElement.classList.add("turno");
            turnoElement.textContent = "Turno " + turnoUsuario;
            nuevoElemento = document.createElement("DIV");
            let añoElement = cabecera.appendChild(nuevoElemento);
            añoElement.classList.add("año");
            añoElement.textContent = añoUsuario;

            // Calcular días desde 2022
            let diasInicioCalendario = 0;
            for (let i = 2022; i < añoUsuario; i++) {
                if ((i % 4 == 0 && i % 100 != 0) || i % 400 == 0) {
                    diasInicioCalendario += 366;
                } else {
                    diasInicioCalendario += 365;
                }
            }

            let año1 = new Año(añoUsuario);
            año1.rellenaAño();
            let calendario1 = new Calendario(año1, turnoUsuario, contenedor, añoUsuario);
            calendario1.rellenarCalendarioTurno(turnoUsuario, diasInicioCalendario);
            calendario1.mostrarAño();

            // Añadir evento al turno para cambiar año/turno
            turnoElement.onclick = function() {
                let nuevoAño, nuevoTurno;
                do {
                    nuevoAño = parseInt(prompt("Introduce el año del que deseas el calendario:   (Mayor de 2022)"), 10);
                } while (isNaN(nuevoAño) || nuevoAño < 2022);
                do {
                    nuevoTurno = prompt("De qué turno quieres el calendario:  A  B  C  D  E").toUpperCase();
                } while (!["A", "B", "C", "D", "E"].includes(nuevoTurno));
                inicializarCalendario(nuevoAño, nuevoTurno);
            };

            // Rellenar el selector de años y sincronizar con el input
const añoActual = new Date().getFullYear();
const añoSelect = document.getElementById('añoSelect');
for (let y = añoActual - 1; y <= añoActual + 10; y++) {
    let opt = document.createElement('option');
    opt.value = y;
    opt.textContent = y;
    añoSelect.appendChild(opt);
}
añoSelect.value = añoActual;
añoInput.value = añoActual;

// Sincroniza el input y el select
añoSelect.onchange = function() {
    añoInput.value = añoSelect.value;
};
añoInput.oninput = function() {
    añoSelect.value = añoInput.value;
};

// Modifica el evento del botón para usar el año del input
document.getElementById('calForm').onsubmit = function(e) {
    e.preventDefault();
    const año = parseInt(añoInput.value, 10);
    const turno = document.getElementById('turnoInput').value;
    if (año >= 2022 && año <= añoActual + 10 && ["A","B","C","D","E"].includes(turno)) {
        inicializarCalendario(año, turno);
        document.getElementById('selector').style.display = 'none';
        document.getElementById('modalOverlay').style.display = 'none';
        document.querySelectorAll('.cabecera, .contenedor').forEach(e => e.classList.remove('oculto'));
    }
};
        }

        // Inicialización al cargar la página
        let fechaActual = new Date();
        let añoActual = fechaActual.getFullYear();
        let turnoUsuario = "C";
        inicializarCalendario(añoActual, turnoUsuario);

        // Mostrar/ocultar el formulario al hacer clic en el icono
document.getElementById('menuIcon').onclick = function() {
    document.getElementById('selector').style.display = 'block';
    document.getElementById('modalOverlay').style.display = 'block';
    document.querySelectorAll('.cabecera, .contenedor').forEach(e => e.classList.add('oculto'));
};
document.getElementById('modalOverlay').onclick = function() {
    document.getElementById('selector').style.display = 'none';
    this.style.display = 'none';
    document.querySelectorAll('.cabecera, .contenedor').forEach(e => e.classList.remove('oculto'));
};
document.getElementById('mostrarBtn').onclick = function() {
    const año = parseInt(document.getElementById('añoInput').value, 10);
    const turno = document.getElementById('turnoInput').value;
    if (año >= 2022 && ["A","B","C","D","E"].includes(turno)) {
        inicializarCalendario(año, turno);
        document.getElementById('selector').style.display = 'none';
        document.getElementById('modalOverlay').style.display = 'none';
        document.querySelectorAll('.cabecera, .contenedor').forEach(e => e.classList.remove('oculto'));
    }
};
    </script>
</body>
</html>
